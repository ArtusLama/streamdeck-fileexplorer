<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="utf-8" />
    <script src="sdpi-components.js"></script>
</head>

<body>

    <!-- TODO: Use folder picker when implemented
    <sdpi-item label="Folder">
        <sdpi-delegate
            setting="folderpath"
            invoke="openfolder"
            label="Open Folder"
        ></sdpi-delegate>
    </sdpi-item>
    -->

    <sdpi-item label="Folder Path">
        <sdpi-textfield
            setting="folderpath"
            placeholder="Enter folder path"
        ></sdpi-textfield>
        <p style="color: red; opacity: 0.9; display: none;" id="pathWarning">
            The provided path is not valid!
            <br>
            Please make sure the folder exists and the path format is correct.
        </p>
        <p style="color: green; opacity: 0.9; display: none;" id="pathValid">
            Valid Path âœ“
        </p>
        <div>
            <p style="cursor: pointer; user-select: none; font-size: 1.2em;" id="rulesToggle">
                <b>Path Rules:</b> <span id="rulesIndicator" style="font-size: 0.9em;">(Show more)</span>
            </p>
            <ul id="rulesList" style="display: none;">
                <li>
                    Use absolute paths only (e.g., <code>C:\Users\YourName\Something</code> on Windows or <code>/Users/YourName/Something</code> on Mac).
                </li>
                <li>
                    The provided path must point to an existing folder.
                </li>
                <li>
                    Don't escape spaces! The plugin handles that automatically.
                </li>
                <li>
                    Don't start or end the path with quotes.
                </li>
            </ul>
        </div>
        

    </sdpi-item>

    <sdpi-item label="Click Action">
        <sdpi-select setting="openaction" placeholder="Select an action">
            <option value="streamdeck">Open on StreamDeck</option>
            <option value="nativeexplorer">Open in native file explorer</option>
            <option value="cmd">Open in Terminal / CMD</option>
            <option value="custom">Run custom command (advanced)</option>
        </sdpi-select>
    </sdpi-item>

    <sdpi-item id="openprofileitem">
        <sdpi-checkbox setting="openprofile" label="Automatically open Profile" default="true"></sdpi-checkbox>
        <p>
            Automatically open the FileExplorerView Profile when the folder gets opened.
            <br>
            <b>
                NOTE: Only MK2 StreamDecks currently support that. For other StreamDecks you have to create your own Profile and switching logic!
            </b>
        </p>
        <p>Alternatively, you can use a Multi-Action and a SwitchProfile Action to achieve similar functionality.</p>
    </sdpi-item>

    <sdpi-item id="customcommanditem">
        <p>
            Shell command where <code>{path}</code> gets replaced with your selected folder path. Example command: <code>explorer {path}</code>
            <br>
            Note that no shell will appear by default. Instead it will execute it in the background.
        </p>
        <sdpi-textarea
            setting="customcommand"
        ></sdpi-textarea>
    </sdpi-item>

    <script>
        const { streamDeckClient } = SDPIComponents;


        function updateCustomCommandItemVisibility() {
            const selectElement = document.querySelector('[setting="openaction"]');
            const selectedValue = selectElement.value;

            const openProfileItem = document.getElementById("openprofileitem");
            const customCommandItem = document.getElementById("customcommanditem");

            openProfileItem.style.display = (selectedValue === "streamdeck") ? "block" : "none";
            customCommandItem.style.display = (selectedValue === "custom") ? "block" : "none";
        }

        document.querySelector('[setting="openaction"]')
            .addEventListener("valuechange", updateCustomCommandItemVisibility);
        // Initial call to set the visibility based on the current value
        updateCustomCommandItemVisibility();


        function updateIsValidPathWarning(isValid) {
            const warningElement = document.getElementById("pathWarning");
            warningElement.style.display = isValid ? "none" : "block";
            validElement.style.display = isValid ? "block" : "none";
        }

        const warningElement = document.getElementById("pathWarning");
        const validElement = document.getElementById("pathValid");
        streamDeckClient.sendToPropertyInspector.subscribe(ev => {
            if (ev.payload && typeof ev.payload.isValid === "boolean") {
                updateIsValidPathWarning(ev.payload.isValid);
            }
        });

        // Collapsible rules section
        const rulesToggle = document.getElementById("rulesToggle");
        const rulesList = document.getElementById("rulesList");
        const rulesIndicator = document.getElementById("rulesIndicator");

        rulesToggle.addEventListener("click", () => {
            const isHidden = rulesList.style.display === "none";
            rulesList.style.display = isHidden ? "block" : "none";
            rulesIndicator.textContent = isHidden ? "(Show less)" : "(Show more)";
        });

    </script>

</body>

</html>